d1 $ every 7 (
  (# cut "0 3") .
  (degradeBy (wchoose [(1.3, 0.4), (0.35, 0.6)])) .
  (# accelerate "[0.4 0.6 [1.2 1.5 1.6] 0.9]/2") .
  (# delay (fromTo 0 0.37)) .
  (# delayt "[0.3 [0.05 0.1] <0.7 0.5> 0.8]") .
  (# delayfb (range 0.1 0.33 $ perlin)) .
  (# size (fromTo 0 0.26)) .
  (# room "0.14 0.22")
) $
stack [
  -- voice
  sometimesBy 0.42 ((density 4) . (fastAppend (s "trp1_fx:13" # gain 0.45))) $
  whenmod 5 3 ((# cut (wchoose [(2, 0.6), (0, 0.4)])) . (# speed "0.4 0.35 <1 0.4>")) $
  loopAt 1 $
  s "trp1_fx:10"
    # gain 0.76
  ,
  -- drone
  whenmod 4 3 (wchoose [(0.25, 0.25), (1.75, 0.25), (1.5, 0.25), (1.25, 0.25)] <~) $
  every 3 (# speed "0.4 <0.32 0.26 0.16> 0.96 0.87") $
  s "ag:6"
    # unit "c"
    # legato 0.6
    # cutoff 900
    # cut (wchoose [(2, 0.3), (0, 0.7)])
    # gain 0.8
  ,
  -- metal
  whenmod 3 2 ((hurry "0.2 0.5 2 6") . (# gain "1 1 0.92 0.86")) $
  s "bm:6*4"
    # gain 0.98
  ,
  -- hihat
  every 3 ((superimpose rev) . (# cut 1)) $
  within (0.2, 0.8) (ghost) $
  s "[grprc:5 _ [grprc:5 grprc:3 ~] grprc:3 [grprc:5*2 ~] grprc:5]*2"
    # speed "1.2 <3 2>"
    # pan 0.66
    # cut "0 1"
    # gain 0.89
  ,
  -- kick1
  sometimesBy 0.22 ((spin 2) . (slow "2 4")) $
  whenmod 4 3 ((degradeBy "[0.22 0.2 [0.15 0.7]]") . (# end "0.25 <0.5 0.75>")) $
  every 2 (fastappend (s "[tkc:5 sine:2 ~*2 tkc:5]*2" # cut 2 # gain 1.2)) $
  s "[tkc:5 sine:2 tkc:5*2 ~]*2"
    # cut 2
    # gain 1.1
  ,
  -- kick2
  whenmod 5 4 (within (0, 0.5) (stutWith "3 5 7" (range 0.125 56 $ rand) ((fastRepeatCycles 4) . (|* gain 0.8)))) $
  every 3 (wchoose [(0.2, 0.65), (0.8, 0.35)] ~>) $
  s "[~ d8k:7 ~ _ d8k:8]*4"
    # gain 0.98
  ,
  -- snare
  someCyclesBy 0.34 (densityGap "0.3 0.7 1.5") $
  s "~ brf:2*3 ~ brf:2"
    # gain 0.95
] # cps 0.2

d1 silence

d2 $ every 10 (
  fastAppend ( -- nappe
    every 4 (superimpose ((# start 0.25) . (rev))) $
    struct (ascii "<[a d] [c e h] f>") $
    sometimesBy 0.21 (fast "2 <1.3 0.5>") $
    fix ((# speed "<0.54 0.36>") . (# gain 0.48)) (s "trp1_fx:33") $
    s "trp1_fx:43 trp1_fx:33"
      # att 3.1
      # speed 0.33
      # hpf 118
      # cut "0 1 1"
      # gain 0.6
    )
) $
stack [
  -- kick
  whenmod 5 4 ((within (0, 0.5) (# cut "<0 1>")) . (within (0.5, 1) (chop "6 8"))) $
  every 3 (within (0.25, 1) (rev)) $
  fix (# gain 0.9) (s "trp2_fx:3") $
  s "~ trp2_fx trp1_8:9 trp2_fx:3"
    # gain 1
  ,
  -- hihat
  sometimesBy 0.24 (stutWith 4 (1/12) ((|* speed 0.5 ) . (slow "3 4 2"))) $
  whenmod 4 2 ((hurry "1.2 0.4 1.1 0.95")) $
  fix ((# begin 0.12) . (# att (range 0.1 0.9 $ slow 6 perlin)) . (# rel "1.2 2.5") . (# gain 0.8)) (s "trp2_h:2") $
  s "[trp2_h*3 [trp2_h:2 trp2_h]*2 [trp2_h:2 _ ~ trp2_h*5] ~ trp2_h:2*2 ~]*2"
    # rel 0.01
    # room "0.02 0.1 0.12 0.15 0.2"
    # gain 0.9
  ,
  -- clap
  every 4 (hurry "0.2 0.7 0.8") $
  every 2 (wchoose [(0.25, 0.25), (1.75, 0.5), (0.5, 0.25)] ~>) $
  chop 8 $
  s "trp1_p:24*4"
    # rel "0.02 0.11 0.01 0.14"
    # gain 0.86
  ,
  -- fx
  sometimesBy 0.4 ((density 24) . (# rel "0.02 0.2 0.15 0.01")) $
  foldEvery [3, 5] (0.5 ~>) $
  degradeBy 0.8 $
  s "trp4_fx:8(5, 4, 2)"
    # gain 0.58
  ,
  -- cloche folle
  whenmod 5 3 (const $ s "~") $
  s "trp3_fx:2*2"
    # rel 2
    # gain 0.72
] # 0.99

d2 silence

d3 $ somecyclesBy 0.43 (slow "1.87 2.54 <1.2 3.12>") $
stack [
  -- ambi
  whenmod 6 4 ((struct (binaryN 7 29)) . (# cut 1)) $
  superimpose (loopAt 1) $
  s "trp1_fx:26"
    # speed 0.97
    # end "0.7 0.8 0.3 0.2 0.01 0.04 0.6"
    # room "0.1 0.3 0.24"
    # size "0.03 0.07 0.2 0.36"
    # gain 0.83
  ,
  -- kick
  whenmod 5 3 (# cutoff (range 237 6554 $ fast 2.5 square)) $
  every 3 (0.25 ~>) $
  every 2 (1.5 <~) $
  fix (# gain 0.92) (s "trp3_8:1") $
  s "{[~ trp1_k:8 _ trp3_8:4 _, ~ trp1_k:31 _]}%3.5"
    # cut 1
    # gain 1.05
  ,
  -- woody
  every 3 (stutWith 2 (1/32) (|* speed 0.6)) $
  s "[east:2 east:9 _ east:14 ~ east:13]*2"
    # size "0.2 0.4 0.02 0.6"
    # room "0.1 0.5 0.03"
    # gain 0.87
  ,
  -- hihat
  sometimesBy 0.3 (superimpose ((0.75 ~>) . (# s "{[~ trp1_h:16 ~, trp1_h:16*3 _, trp1_h:16 ~ trp1_h:16*2 _ trp1_h:16*2]}%1.75") . (within (0.2, 0.8) (rev)))) $
  s "{[~ trp1_h:16 ~ trp1_h:16*3 _, trp1_h:16 ~ trp1_h:16*2 _ trp1_h:16*2]}%1.75"
    # pan (range 0.55 1 $ fast 3 cosine) -- 0.75
    # rel 0.0098
    # gain 0.95
  ,
  -- fx
  whenmod 5 3 ((degradeBy 0.3) . (fast "2 0.7 0.4") . (spin "3 1.8 0.21")) $
  every 4 ((fast 2) . (palindrome)) $
  every 2 (rev) $
  sometimesBy 0.65 (fix (# gain 0) (s "atm")) $
  s "{atm _ af af:6 ~}%3.5"
    # gain 0.67
] # cps 0.27

d3 silence

hush
